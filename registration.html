<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="./Css/bootstrap.min.css">
    <link rel="stylesheet" href="./registration.css">
    <title>Best Brain</title>
    <link rel="icon" type="image/x-icon" href="./Assets/favicon.ico">
    <script src="https://code.jquery.com/jquery-3.3.1.js"></script>
    <script src="https://kit.fontawesome.com/64d58efce2.js" crossorigin="anonymous"></script>
    <style>
        @import url("https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;300;400;500;600;700;800&display=swap");

        body {
            margin: 0;
            padding: 0;
            font-family: "Poppins", sans-serif;
            background-color: #f3f7f7;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        .card {
            width: 90%;
            max-width: 400px;
            /* background-color: #000; */
            background-color: #000aba;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px;
            border-radius: 20px;
            box-sizing: border-box;
            position: relative;
        }

        .form {
            width: 100%;
            display: flex;
            flex-direction: column;
        }

        .form input, .form select {
            padding: 12px;
            margin-bottom: 10px;
            border-radius: 5px;
            border: 1px solid #003C96;
            color: #003C96;
            width: 100%;
            box-sizing: border-box;
            font-family: "Poppins", sans-serif;
            font-size: 80%;
            font-weight: bold;
            background-color: white;
        }

        .login_btn, .confirm_btn, .cancel_btn {
            font-size: 20px;
            color: white;
            border-radius: 15px;
            border: none;
            background: linear-gradient(-90deg, #d31005, #d31005);
            padding: 12px;
            margin-top: 15px;
            width: 100%;
            cursor: pointer;
            font-weight: bold;
            text-align: center;
        }

        .registration-form {
            display: none;
        }

        .class-inputs {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .class-inputs input {
            padding: 10px;
            margin-bottom: 5px;
            font-size: 80%;
            font-weight: normal;
        }

        @media only screen and (max-width: 768px) {
            .card {
                padding: 30px;
            }

            .login_btn, .confirm_btn, .cancel_btn {
                font-size: 18px;
            }
        }

        @media only screen and (max-width: 480px) {
            .card {
                padding: 20px;
                width: 95%;
                max-width: 350px;
            }

            .login_btn, .confirm_btn, .cancel_btn {
                font-size: 16px;
                padding: 10px;
            }

            .form input, .form select {
                padding: 10px;
            }
        }

        @media only screen and (max-width: 360px) {
            .card {
                padding: 15px;
                width: 100%;
                max-width: 320px;
            }

            .login_btn, .confirm_btn, .cancel_btn {
                font-size: 14px;
                padding: 8px;
            }

            .form input, .form select {
                padding: 8px;
                margin-bottom: 10px;
            }
        }

          /* Modal Styles */
          .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            border-radius: 10px;
            padding: 20px;
            max-width: 90%;
            width: 400px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            text-align: center;
        }

        .modal-icon {
            font-size: 40px;
            color:  #000aba;
            margin-bottom: 10px;
        }

        .modal-btn {
            background-color: #000aba;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 10px 40px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 20px;
        }
    </style>
</head>
<body>

    <div class="card">
        <h2>Add Your School</h2>

        <div class="form">
            <div class="input-group mb-3">
                <input type="text" id="schoolName" class="form-control" placeholder="School Name">
            </div>

            <div class="input-group mb-3">
                <input type="tel" id="contact" class="form-control" placeholder="Contact" maxlength="10" pattern="\d{10}" required oninput="validateContact()">
            </div>
            
            <div class="input-group mb-3">
                <input type="text" id="location" class="form-control" placeholder="Location">
            </div>

            <!-- Ghanaian Language Selection -->
            <div class="input-group mb-2">
                <select id="language" class="form-control">
                    <option value="">Select a Ghanaian Language</option>
                    <option value="Asante Twi">Asante Twi</option>
                    <option value="Akwapem Twi">Akwapem Twi</option>
                    <option value="Fante">Fante</option>
                    <option value="Ga">Ga</option>
                    <option value="Dagbani">Dagbani</option>
                    <option value="Dangme">Dangme</option>
                    <option value="Ewe">Ewe</option>
                    <option value="Nzema">Nzema</option>
                    <option value="Gonja">Gonja</option>
                    <option value="Kasem">Kasem</option>
                    <option value="Dagaare">Dagaare</option>
                    <option value="Dagbane">Dagbane</option>
                    <option value="None">None</option>
                </select>
            </div>

            <!-- French Dropdown -->
            <div class="input-group mb-3">
                <select id="frenchOption" class="form-control">
                    <option value="">Add French (Select Yes or No)</option>
                    <option value="yes">Yes</option>
                    <option value="no">No</option>
                </select>
            </div>

            <!-- Exam Type Selection -->
            <div class="input-group mb-4">
                <select id="registrationType" onchange="showForm()" class="form-control">
                    <option value="">Exam Types</option>
                    <option value="mock">Mock Registration</option>
                    <option value="terminal">Terminal Registration</option>
                </select>
            </div>

            <!-- Terminal Candidates Input -->
            <div id="terminalCandidates" style="display:none;">
                <div class="class-inputs">
                    <input type="tel" id="nursery" class="form-control" placeholder="Nursery" min="0">
                    <input type="tel" id="kg1" class="form-control" placeholder="KG 1" min="0">
                    <input type="tel" id="kg2" class="form-control" placeholder="KG 2" min="0">
                    <input type="tel" id="basic1" class="form-control" placeholder="Basic 1" min="0">
                    <input type="tel" id="basic2" class="form-control" placeholder="Basic 2" min="0">
                    <input type="tel" id="basic3" class="form-control" placeholder="Basic 3" min="0">
                    <input type="tel" id="basic4" class="form-control" placeholder="Basic 4" min="0">
                    <input type="tel" id="basic5" class="form-control" placeholder="Basic 5" min="0">
                    <input type="tel" id="basic6" class="form-control" placeholder="Basic 6" min="0">
                    <input type="tel" id="basic7" class="form-control" placeholder="Basic 7" min="0">
                    <input type="tel" id="basic8" class="form-control" placeholder="Basic 8" min="0">
                    <input type="tel" id="basic9" class="form-control" placeholder="Basic 9" min="0">
                </div>
            </div>

              <!-- Mock Exam Types Input -->
<div id="mockExamTypes" style="display:none;">
    <div class="input-group mb-3">
        <input type="tel" id="mockExamCount" class="form-control" placeholder="Enter Number of Candidate" min="0">
    </div>
</div>


            <div id="summarySection" class="registration-form" style="display:none;">
                <h4>Summary</h4>
                <p id="summaryText"></p>
                <button id="confirmBtn" class="confirm_btn" onclick="confirmRegistration()">Confirm</button>
                <button id="cancelBtn" class="cancel_btn" onclick="resetForm()">Cancel</button>
            </div>

            <button type="button" class="login_btn" onclick="confirmRegistration()">Register</button>
        </div>
    </div>



    <!-- Modal -->
    <div id="customModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-icon"><i class="fas fa-check-circle"></i></div>
            <h3 id="modalTitle">Registration Successful</h3>
            <p id="modalMessage">Your registration details have been submitted successfully.</p>
            <button class="modal-btn" onclick="closeModal()">OK</button>
        </div>
    </div>


    

<!-- ///////////////////////////////////////////////////  -->

    

    <script>
  function confirmRegistration() {
    // Gather form data
    const schoolName = document.getElementById("schoolName").value.trim();
    const contact = document.getElementById("contact").value.trim();
    const location = document.getElementById("location").value.trim();
    const language = document.getElementById("language").value.trim();
    const registrationType = document.getElementById("registrationType").value;
    const frenchOption = document.getElementById("frenchOption").value === "yes"; // boolean value for French

    // Check if required fields are filled
    if (!schoolName || !contact || !location || !registrationType) {
        alert("Please fill all the required fields.");
        return;
    }

    // Prepare payload
    const commonPayload = {
        school_name: schoolName,
        contact: contact,
        location: location,
        gh_language: language,
        french: frenchOption
    };

    let payload = {};
    let apiUrl = '';

    // Handle mock or terminal registration
    if (registrationType === "mock") {
        const mockExamCount = parseInt(document.getElementById("mockExamCount").value) || 0;
        payload = { ...commonPayload, enrollment: mockExamCount };
        apiUrl = 'http://localhost:3000/v1/register/mock'; // Mock exam API
    } else if (registrationType === "terminal") {
        const nursery = parseInt(document.getElementById("nursery").value) || 0;
        const kg1 = parseInt(document.getElementById("kg1").value) || 0;
        const kg2 = parseInt(document.getElementById("kg2").value) || 0;
        const basic1 = parseInt(document.getElementById("basic1").value) || 0;
        const basic2 = parseInt(document.getElementById("basic2").value) || 0;
        const basic3 = parseInt(document.getElementById("basic3").value) || 0;
        const basic4 = parseInt(document.getElementById("basic4").value) || 0;
        const basic5 = parseInt(document.getElementById("basic5").value) || 0;
        const basic6 = parseInt(document.getElementById("basic6").value) || 0;
        const basic7 = parseInt(document.getElementById("basic7").value) || 0;
        const basic8 = parseInt(document.getElementById("basic8").value) || 0;

        payload = {
            ...commonPayload,
            nursery_enrollment: nursery,
            kg_enrollment: kg1 + kg2,
            basic_1_enrollment: basic1,
            basic_2_enrollment: basic2,
            basic_3_enrollment: basic3,
            basic_4_enrollment: basic4,
            basic_5_enrollment: basic5,
            basic_6_enrollment: basic6,
            basic_7_enrollment: basic7,
            basic_8_enrollment: basic8
        };
        apiUrl = 'http://localhost:3000/v1/register/terminal'; // Terminal exam API
    } else {
        alert("Please select a valid registration type.");
        return;
    }

    // Log the payload and API URL for debugging
    console.log("Payload:", payload);
    console.log("API URL:", apiUrl);

    // Get the token from localStorage
    const apiToken = localStorage.getItem('apiToken');

    // Ensure the token exists before making the request
    if (!apiToken) {
        alert("API token is missing. Please log in.");
        return;
    }

    // Send the payload to the backend
    fetch(apiUrl, {
        method: 'POST',
        headers: { 
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${apiToken}` // Add token to headers if your API requires it
        },
        body: JSON.stringify(payload)
    })
    .then(response => {
        // Check if the content-type is JSON before parsing
        const contentType = response.headers.get('content-type');
        
        if (contentType && contentType.includes('application/json')) {
            // Response is JSON, parse it
            return response.json();
        } else {
            // If not JSON, return the text response for debugging
            return response.text().then(text => {
                console.error("Non-JSON response:", text);
                throw new Error("Expected JSON response but received: " + text);
            });
        }
    })
    .then(data => {
        console.log("Success:", data);
        document.getElementById('customModal').style.display = 'flex';
        document.getElementById('modalTitle').innerText = "Registration Successful";
        document.getElementById('modalMessage').innerText = "Your registration details have been submitted successfully.";
        resetForm();
    })
    .catch(error => {
        console.error("Error during registration:", error);
        let errorMessage = 'An error occurred during registration. Please try again.';
        if (error.message) {
            errorMessage = error.message;
        }
        alert(errorMessage);
    });
}

function showForm() {
    const registrationType = document.getElementById("registrationType").value;
    const terminalCandidates = document.getElementById("terminalCandidates"); // Terminal enrollment section
    const mockExamTypes = document.getElementById("mockExamTypes"); // Mock enrollment section

    // Show or hide form sections based on the selected registration type
    if (registrationType === "mock") {
        terminalCandidates.style.display = "none"; // Hide terminal inputs
        mockExamTypes.style.display = "block"; // Show mock inputs
    } else if (registrationType === "terminal") {
        terminalCandidates.style.display = "block"; // Show terminal inputs
        mockExamTypes.style.display = "none"; // Hide mock inputs
    } else {
        terminalCandidates.style.display = "none"; // Hide both if no valid selection
        mockExamTypes.style.display = "none";
    }
}

// Call showForm when the page loads to ensure the form is in the correct state
window.onload = function() {
    showForm();
};

// Ensure that showForm is triggered when the registration type is changed
document.getElementById("registrationType").addEventListener("change", showForm);

    </script>
</body>
</html>
